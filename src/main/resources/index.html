<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTTP 服务器场景展示</title>
    <script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/js-cookie/latest/js.cookie.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.9.0/qs.min.js"></script>
    <script src="https://cdn.bootcss.com/fetch/3.0.0/fetch.min.js"></script>
</head>
<body>
<h1>HTTP 方法展示</h1>
<ul>
    <li><a href="localhost:8080/method/get">GET</a></li>
    <li><a href="localhost:8080/method/post">POST</a></li>
    <li><a href="localhost:8080/method/put">PUT</a></li>
    <li><a href="localhost:8080/method/patch">PATCH</a></li>
    <li><a href="localhost:8080/method/delete">DELETE</a></li>
    <li><a href="localhost:8080/method/trace">TRACE</a></li>
    <li><a href="localhost:8080/method/connect">CONNECT</a></li>
    <li><a href="localhost:8080/method/head">HEAD</a></li>
    <li><a href="localhost:8080/method/options">OPTIONS</a></li>
</ul>
<h1>HTTP 响应码展示</h1>
<ul>
    <li><a href="http://localhost:8080/status/200">200</a></li>
    <li><a href="http://localhost:8080/status/301">301</a></li>
    <li><a href="http://localhost:8080/status/404">404</a></li>
    <li><a href="http://localhost:8080/status/500">500</a></li>
</ul>
<h1>MIME 类型展示</h1>
<ul>
    <li><a href="http://localhost:8080/mime/image/hello.jpg">image/jpeg</a></li>
    <img style="margin: auto;height: 200px; width: 200px" src="http://localhost:8080/mime/image/hello.jpg">
    <li><a href="http://localhost:8080/mime/image/bye.gif">image/gif</a></li>
    <img style="margin: auto;height: 200px; width: 200px" src="http://localhost:8080/mime/image/bye.gif">
    <li><a href="http://localhost:8080/mime/text/text.plain">text/plain 点我试试</a></li>
    <li><a href="http://localhost:8080/mime/text/text.html">text/html 点我试试</a></li>
   <li><a href="http://localhost:8080/mime/video/movie.mp4">video/mp4 点我试试</a></li>
    <video src="http://localhost:8080/mime/video/movie.mp4" controls="controls">
        您的浏览器不支持 video 标签。
    </video>
</ul>
<div>

</div>
<h1>Http 内容编码展示</h1>
<ul>
    <li>
        <button id="gzip">gzip</button>
        <span id="gzip-content">等下这里会显示 gzip 的内容</span>
    </li>
</ul>
<h1>Http Cookie 展示</h1>
<h2>会话 Cookie 展示</h2>
<span>当前登录用户为: </span>
<span id="session-cookie-username"></span>
<label>
    <input id="session-cookie-input" name="name" type="text">
</label>
<button id="session-cookie-login">登录</button>
<h1>Http 分块展示</h1>
<ul>
    <li>
        <button id="chunk">chunk</button>
    </li>
    <li>
        <span id="chunk-content">chunk 内容将在此处展示</span>
    </li>
</ul>
<script>
    axios.baseURL = "http://localhost:8080";
    axios.defaults.withCredentials = true;
    // axios.defaults.headers.common['Origin'] = 'http://localhost';
    $(document).ready(function () {
        var username = Cookies.get('username');
        if (typeof username !== "undefined") {
            $("#session-cookie-username").text(username);
        }
        $("#gzip").click(gzip);
        $("#chunk").click(chunk);
        $("#session-cookie-login").click(session_cookie_login);
    });

    function gzip() {
        console.log("click gzip");
        // Make a request for a user with a given ID
        axios.get('/content-encoding')
            .then(function (response) {
                // handle success
                console.log(response);
                $("#gzip-content").text(response.data);
            })
            .catch(function (error) {
                // handle error
                console.log(error);
            })
            .finally(function () {
                // always executed
            });
    }

    function session_cookie_login() {
        console.log("click session cookie login");
        let username = $("#session-cookie-input").val();
        console.log("username:" + username);
        let data = "username=" + username;
        axios({
            method: 'post',
            url: '/cookie/session',
            data: data,
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            withCredentials: true
        }).then(function (response) {
            // handle success
            console.log(response);
            console.log(response.headers['set-cookie']);

            console.log(document.cookie);
            console.log(Cookies.get());
            console.log(Cookies.get('username'));
            var username = Cookies.get('username');
            if (typeof username !== "undefined") {
                $("#session-cookie-username").text(username);
            }
        }).catch(function (error) {
            // handle error
            console.log(error);
        }).finally(function () {
            // always executed
        });
    }

    function chunk() {
        console.log("click gzip");
        $("#chunk-content").text("");
        var lastIndex = 0;
        var query = new XMLHttpRequest();

        query.onreadystatechange = function () {
            if (query.readyState === 3) {
                //每次返回的数据responseText会包含上次的数据，所以需要手动substring一下
                var info = query.responseText.substring(lastIndex);
                $('#chunk-content').append('<div>' + info + '</div>');

                lastIndex = query.responseText.length;
            }
        };
        query.open("GET", "http://localhost:8080/chunk", true);
        query.send(null);
    }
</script>
</body>
</html>